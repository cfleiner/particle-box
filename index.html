<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <title>Particle Box - Demo</title>
</head>
<body>



<div class="container-fluid full-window" style="width: 100%; height: 100%;">
    <canvas id="bg-canvas"></canvas>
    
   

    <div class="centered-container">
        <canvas id="img-canvas"></canvas>
    </div>
    
   
</div>

<div class="container">
    <div class="hstack gap-3 lower-menu justify-content-center align-items-center">
        <button class="btn btn-secondary" onclick="toggleSidebar('left-sidebar')"><i class="fa-solid fa-gears"></i> Edit window</button>
        <a class="btn btn-secondary" href="https://github.com/cfleiner/particle-box"> <i class="fab fa-github"></i> GitHub</a>
        <button class="btn btn-secondary" onclick="toggleSidebar('right-sidebar')"><i class="fa-solid fa-gears"></i> Edit center</button>
    </div>
  </div>


<div class="container overflow-auto sidebar sidebar-left show" id="left-sidebar">
    <button class="close-btn" onclick="toggleSidebar('left-sidebar')">&times;</button>
    <h3 class="py-3">Configure Background</h3>

        <div class="accordion" id="bg-accordion">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#bg-acc-appearance" aria-expanded="false" aria-controls="bg-acc-appearance">
                  Appearance
                </button>
              </h2>
              <div id="bg-acc-appearance" class="accordion-collapse collapse" data-bs-parent="#bg-accordion">
                <div class="accordion-body">
                   
                    <div>
                        <label for="bg-shape" class="form-label">Particle Shape</label>
                        <select id="bg-shape" class="form-select bg-ctrl shape" aria-label="Particle Shape">
                            <option value="circle">Circle</option>
                            <option value="square">Square</option>
                            <option value="triangle-up">Triangle (upwards pointing)</option>
                            <option value="triangle-down">Triangle (downwards pointing)</option>
                            <option value="triangle" selected>Triangle (toggling)</option>
                        </select>
                    </div>
                 
                    <div>
                        <label for="bg-particle-size" class="form-label">Particle Size: <span class="rangeValue"></span></label>
                        <input type="range" class="form-range bg-ctrl particle-size"  min="1" max="30" step="1" value="7"  id="bg-particle-size">
                    </div>

                    <div>
                        <label for="bg-size-function" class="form-label">Particle size function</label>
                        <select id="bg-size-function" class="form-select bg-ctrl size-function" aria-label="Particle Size Function">
                            <option value="none">none</option>
                            <option value="random" selected>random size</option>
                            <option value="gray">size relative to gray</option>
                        </select>
                    </div>
            
                    <div>
                        <label for="bg-gap-factor" class="form-label">Gap Factor: <span class="rangeValue"></span></label>
                        <input type="range" class="form-range bg-ctrl gap-factor"  min="1" max="30" step="1" value="20"  id="bg-gap-factor">
                    </div>

                </div>
              </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#bg-acc-colors" aria-expanded="false" aria-controls="bg-acc-colors">
                    Colors
                  </button>
                </h2>
                <div id="bg-acc-colors" class="accordion-collapse collapse" data-bs-parent="#bg-accordion">
                  <div class="accordion-body">
                    
                    <div>
                        <label for="bg-color" class="form-label">Background Color</label>
                        <div class="d-flex align-items-center">
                        <input type="color" class="form-control form-control-color bg-ctrl bg-color" id="bg-bg-color" value="#264121" title="Choose your color">
                        <span class="colorValue mx-3">#264121</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="bg-colors" class="form-label">Particle Colors</label>
                        <textarea class="form-control my-textarea bg-ctrl colors" id="bg-colors" rows="3">#9DC097, #82967F, #9EEB91
                        </textarea>
                    </div>

                  </div>
                </div>
              </div>

            <div class="accordion-item"> 
                <h2 class="accordion-header">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#bg-acc-behavior" aria-expanded="true" aria-controls="bg-acc-behavior">
                    Behavior
                  </button>
                </h2>
                <div id="bg-acc-behavior" class="accordion-collapse collapse" data-bs-parent="#bg-accordion">
                  <div class="accordion-body">

                    <div>
                        <label for="bg-particle-friction" class="form-label">Particle friction: <span class="rangeValue"></span></label>
                        <input type="range" class="form-range bg-ctrl particle-friction"  min="0" max="1" step="0.01" value="0.80"  id="bg-particle-friction">
                    </div>

                  </div>
                </div>
            </div>

            <div class="accordion-item"> <!-- start image -->
                <h2 class="accordion-header">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#bg-acc-image" aria-expanded="false" aria-controls="bg-acc-image">
                    Image
                  </button>
                </h2>
                <div id="bg-acc-image" class="accordion-collapse collapse" data-bs-parent="#bg-accordion">
                  <div class="accordion-body">
                    
                    <div class="mb-3">
                        <label for="bg-image-url" class="form-label">Image (JPG) Url</label>
                        <input type="url" class="form-control bg-ctrl image-url" id="bg-image-url" placeholder="http://www.example.com/image.jpg">
                    </div>

                    <div>
                        <label for="bg-pooling-method" class="form-label">Pooling Method</label>
                        <select id="bg-pooling-method" class="form-select bg-ctrl pooling-method" aria-label="Pooling Method">
                            <option value="maximum" selected>maximum</option>
                            <option value="average">average</option>
                        </select>
                    </div>

                    <div>
                        <label for="bg-pooling-size" class="form-label">Pooling Size: <span class="rangeValue"></span></label>
                        <input type="range" class="form-range bg-ctrl pooling-size"  min="0" max="100" step="1" value="4"  id="bg-pooling-size">
                    </div>

                    <div>
                        <label for="bg-gray-method" class="form-label">Graying Method</label>
                        <select id="bg-gray-method" class="form-select bg-ctrl gray-method" aria-label="Graying Method">
                            <option value="average">Average</option>
                            <option value="lightness">Lightness</option>
                            <option value="luminosity" selected>Luminosity</option>
                        </select>
            
                        <label for="bg-gray-threshold" class="form-label">Gray threshold: <span class="rangeValue"></span></label>
                        <input type="range" class="form-range bg-ctrl gray-threshold"  min="0" max="255" step="1" value="255"  id="bg-gray-threshold">
                    </div>
                  </div>
                </div>
            </div> <!-- end image -->

            <div class="accordion-item"> <!-- start zoom -->
                <h2 class="accordion-header">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#bg-acc-zoom" aria-expanded="false" aria-controls="bg-acc-zoom">
                    Zoom
                  </button>
                </h2>

                <div id="bg-acc-zoom" class="accordion-collapse collapse show" data-bs-parent="#bg-accordion"> 
                  <div class="accordion-body">
                    <div class="form-check form-switch">
                        <input class="form-check-input bg-ctrl zoom-keep-size" type="checkbox" role="switch" id="bg-zoom-keep-size">
                        <label class="form-check-label" for="bg-zoom-keep-size">Keep particle size</label>
                    </div>
            
                    <div class="form-check form-switch">
                        <input class="form-check-input bg-ctrl zoom-keep-population" type="checkbox" role="switch" id="bg-zoom-keep-population">
                        <label class="form-check-label" for="bg-zoom-keep-population">Keep particle population</label>
                    </div>
                  </div>
                </div> <!-- end zoom -->
            </div> <!-- end accordion -->
        
           
        </div> <!-- end of accordion -->
      
        <div class="container py-3">
            <button id="btn-bg" type="button" class="btn btn-secondary" style="width: 200px">Update</button>
        </div>
       
</div>





<div class="sidebar sidebar-right" id="right-sidebar">
    <button class="close-btn" onclick="toggleSidebar('right-sidebar')">&times;</button>
    <h3>Configure Center</h3>
    <p>Some content here...</p>
</div>


<script>
    

$('#btn-bg').on('click', () => updateConfig('.bg-ctrl')); 
$('#btn-center').on('click', () => updateConfig('.center-ctrl'))
    
    
function updateConfig(cls) {
    const config = {
        keepParticleSize: $(cls + '.zoom-keep-size').is(':checked'), 
        keepParticlePopulation: $(cls + '.zoom-keep-population').is(':checked'), 
        poolingSize: $(cls + '.pooling-size').val() ,
        threshold:   $(cls + '.gray-threshold').val(),
        particleSize: $(cls + '.particle-size').val(),
        particleFriction: $(cls + '.particle-friction').val(),
        factor: $(cls + '.gap-factor').val(), 
        grayMethod:  $(cls + '.gray-method').val(),
        pathToJPG: $(cls + '.image-url').val(),
        poolingMethod: $(cls + '.pooling-method').val(),
        colors :  $(cls + '.colors').val().trim().replace(/,/g, ' ').split(/\s+/),
        bgColor: $(cls + '.bg-color').val(),
    };

    if ($(cls + '.size-function').val() !== 'none') {
        config['particleSizeFunction'] = 'particleSize.' + $(cls + '.size-function').val()
    } 
    
    const arr = $(cls + '.shape').val().split('-')
    config['geometry'] = arr[0]

    if (arr.length > 1) {
        config['pointsDown'] =  (arr[1] === "down");
    }




    alert(JSON.stringify(config));
    
}



    function toggleSidebar(id) {
        const sidebar = document.getElementById(id);
        sidebar.classList.toggle('show');
    }
</script>

<script src="./index.js"></script>
<script src="./particleBox.js"></script>
</body>
</html>