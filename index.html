<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <title>Particle Box - Demo</title>
</head>
<body>


<div class="container-fluid full-window" style="width: 100%; height: 100%;">
    <canvas id="bg-canvas"></canvas>
    <button class="btn btn-primary top-left-button" onclick="toggleSidebar('left-sidebar')">Edit WindowBox </button>
    <button class="btn btn-secondary top-right-button" onclick="toggleSidebar('right-sidebar')">Edit ImageBox</button>

    <div class="centered-container">
        <canvas id="img-canvas"></canvas>
        <!-- Your content here -->
    </div>
</div>

<div class="container overflow-auto sidebar sidebar-left show" id="left-sidebar">
    <button class="close-btn" onclick="toggleSidebar('left-sidebar')">&times;</button>
    <h3>Configure Background</h3>
    <form>
      
        <div class="mb-3">
            <!-- // pathToJPG: 'http://127.0.0.1:5500/schwarzbild.jpg', -->
            <label for="bg-image-url" class="form-label">Image (JPG) Url</label>
            <input type="url" class="form-control bg-ctrl image-url" id="bg-image-url" placeholder="http://www.example.com/image.jpg">
        </div>

        <div>
            <!--  poolingSize: 4,  -->
            <label for="bg-pooling-size" class="form-label">Pooling Size: <span class="rangeValue"></span></label>
            <input type="range" class="form-range bg-ctrl pooling-size"  min="0" max="100" step="1" value="4"  id="bg-pooling-size">
        </div>

        
        <div>
            <label for="bg-pooling-method" class="form-label">Pooling Method</label>
            <select id="bg-pooling-method" class="form-select bg-ctrl pooling-method" aria-label="Pooling Method">
                <option value="maximum" selected>maximum</option>
                <option value="average">average</option>
            </select>
        </div>
        
        <div>
            <label for="bg-particle-size" class="form-label">Particle Size: <span class="rangeValue"></span></label>
            <input type="range" class="form-range bg-ctrl particle-size"  min="1" max="30" step="1"  id="bg-particle-size">
        </div>

        <div>
            <label for="bg-gap-factor" class="form-label">Gap Factor: <span class="rangeValue"></span></label>
            <input type="range" class="form-range bg-ctrl gap-factor"  min="1" max="30" step="1"  id="bg-gap-factor">
        </div>


        <div>
            <label for="bg-size-function" class="form-label">Particle size function</label>
            <select id="bg-size-function" class="form-select bg-ctrl size-function" aria-label="Particle Size Function">
                <option value="none">none</option>
                <option value="random">random size</option>
                <option value="gray">size relative to gray</option>
            </select>
        </div>
       
      

        <div>
            <label for="bg-color" class="form-label">Background Color</label>
            <div class="d-flex align-items-center">
            <input type="color" class="form-control form-control-color bg-ctrl bg-color" id="bg-bg-color" value="#563d7c" title="Choose your color">
            <span class="colorValue mx-3">#563d7c</span>
            </div>
        </div>
        <div class="mb-3">
            <label for="bg-colors" class="form-label">Particle Colors</label>
            <textarea class="form-control my-textarea bg-ctrl colors" id="bg-colors" rows="3">
                green,
                yellow,
                blue
            </textarea>
        </div>


        <div>
            <label for="bg-shape" class="form-label">Particle Shape</label>
            <select id="bg-shape" class="form-select bg-ctrl shape" aria-label="Particle Shape">
                <option value="circle" selected>Circle</option>
                <option value="square">Square</option>
                <option value="triangle-up">Triangle (upwards pointing)</option>
                <option value="triangle-down">Triangle (downwards pointing)</option>
                <option value="triangle">Triangle (toggling)</option>
            </select>
        </div>

        <div>
            <!-- grayMethod: 'luminosity', // lightness, average -->
            <label for="bg-gray-method" class="form-label">Graying Method</label>
            <select id="bg-gray-method" class="form-select bg-ctrl gray-method" aria-label="Graying Method">
                <option value="average">Average</option>
                <option value="lightness">Lightness</option>
                <option value="luminosity" selected>Luminosity</option>
            </select>

            <!-- threshold: 255, // 0 (black) to 255 (white) -->
            <label for="bg-gray-threshold" class="form-label">Gray threshold: <span class="rangeValue"></span></label>
            <input type="range" class="form-range bg-ctrl gray-threshold"  min="0" max="255" step="1"  id="bg-gray-threshold">
        </div>

        <div>
            <!-- particleFriction: 0.8 // the smaller, the faster it returns to original place, if 1 it stays, > 1, it's gone -->
            <label for="bg-particle-friction" class="form-label">Particle friction: <span class="rangeValue"></span></label>
            <input type="range" class="form-range bg-ctrl particle-friction"  min="0" max="1" step="0.01"  id="bg-particle-friction">
        </div>

        <div class="form-check form-switch">
            <!-- keepParticleSize: false, // if false, the size of particles changes relative to zooming -->
            <input class="form-check-input bg-ctrl zoom-keep-size" type="checkbox" role="switch" id="bg-zoom-keep-size" checked>
            <label class="form-check-label" for="bg-zoom-keep-size">Keep particle size</label>
        </div>

        <div class="form-check form-switch">
            <!-- keepParticlePopulation: false, // particles count remains the same when zooming -->
            <input class="form-check-input bg-ctrl zoom-keep-population" type="checkbox" role="switch" id="bg-zoom-keep-population" checked>
            <label class="form-check-label" for="bg-zoom-keep-population">Keep particle population</label>
        </div>

        <button id="btn-bg" type="button" class="btn btn-primary">Update</button>
    </form>
</div>





<div class="sidebar sidebar-right" id="right-sidebar">
    <button class="close-btn" onclick="toggleSidebar('right-sidebar')">&times;</button>
    <h3>Configure Center</h3>
    <p>Some content here...</p>
</div>


<script>
    

$('#btn-bg').on('click', () => updateConfig('.bg-ctrl')); 
$('#btn-center').on('click', () => updateConfig('.center-ctrl'))
    
    
function updateConfig(cls) {
    const config = {
        keepParticleSize: $(cls + '.zoom-keep-size').is(':checked'), 
        keepParticlePopulation: $(cls + '.zoom-keep-population').is(':checked'), 
        poolingSize: $(cls + '.pooling-size').val() ,
        threshold:   $(cls + '.gray-threshold').val(),
        particleSize: $(cls + '.particle-size').val(),
        particleFriction: $(cls + '.particle-friction').val(),
        factor: $(cls + '.gap-factor').val(), 
        grayMethod:  $(cls + '.gray-method').val(),
        pathToJPG: $(cls + '.image-url').val(),
        poolingMethod: $(cls + '.pooling-method').val(),
        colors :  $(cls + '.colors').val().trim().replace(/,/g, ' ').split(/\s+/)
    };

    if ($(cls + '.size-function').val() !== 'none') {
        config['particleSizeFunction'] = 'particleSize.' + $(cls + '.size-function').val()
    } 
    
    const arr = $(cls + '.shape').val().split('-')
    config['geometry'] = arr[0]

    if (arr.length > 1) {
        config['pointsDown'] =  (arr[1] === "down");
    }


   
        

    alert(JSON.stringify(config));
    
}



    function toggleSidebar(id) {
        const sidebar = document.getElementById(id);
        sidebar.classList.toggle('show');
    }
</script>

<script src="./index.js"></script>
<script src="./particleBox.js"></script>
</body>
</html>